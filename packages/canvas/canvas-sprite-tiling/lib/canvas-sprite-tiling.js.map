{"version":3,"file":"canvas-sprite-tiling.js","sources":["../src/TilingSprite.ts"],"sourcesContent":["import { TilingSprite } from '@pixi/sprite-tiling';\nimport { canvasUtils } from '@pixi/canvas-renderer';\nimport { CanvasRenderTarget } from '@pixi/utils';\nimport { Matrix, Point } from '@pixi/math';\n\nimport type { CanvasRenderer } from '@pixi/canvas-renderer';\n\nconst tempMatrix = new Matrix();\nconst tempPoints = [new Point(), new Point(), new Point(), new Point()];\n\n/**\n * Renders the object using the Canvas renderer\n *\n * @protected\n * @function _renderCanvas\n * @memberof PIXI.TilingSprite#\n * @param {PIXI.CanvasRenderer} renderer - a reference to the canvas renderer\n */\nTilingSprite.prototype._renderCanvas = function _renderCanvas(renderer: CanvasRenderer): void\n{\n    const texture = this._texture;\n\n    if (!texture.baseTexture.valid)\n    {\n        return;\n    }\n\n    const context = renderer.context;\n    const transform = this.worldTransform;\n    const baseTexture = texture.baseTexture;\n    const source = baseTexture.getDrawableSource();\n    const baseTextureResolution = baseTexture.resolution;\n\n    // create a nice shiny pattern!\n    if (this._textureID !== this._texture._updateID || this._cachedTint !== this.tint)\n    {\n        this._textureID = this._texture._updateID;\n        // cut an object from a spritesheet..\n        const tempCanvas = new CanvasRenderTarget(texture._frame.width,\n            texture._frame.height,\n            baseTextureResolution);\n\n        // Tint the tiling sprite\n        if (this.tint !== 0xFFFFFF)\n        {\n            this._tintedCanvas = canvasUtils.getTintedCanvas(this, this.tint) as HTMLCanvasElement;\n            tempCanvas.context.drawImage(this._tintedCanvas, 0, 0);\n        }\n        else\n        {\n            tempCanvas.context.drawImage(source,\n                -texture._frame.x * baseTextureResolution, -texture._frame.y * baseTextureResolution);\n        }\n        this._cachedTint = this.tint;\n        this._canvasPattern = tempCanvas.context.createPattern(tempCanvas.canvas, 'repeat');\n    }\n\n    // set context state..\n    context.globalAlpha = this.worldAlpha;\n    renderer.setBlendMode(this.blendMode);\n\n    this.tileTransform.updateLocalTransform();\n    const lt = this.tileTransform.localTransform;\n    const W = this._width;\n    const H = this._height;\n\n    tempMatrix.identity();\n    tempMatrix.copyFrom(lt);\n    tempMatrix.prepend(transform);\n\n    renderer.setContextTransform(tempMatrix);\n\n    // fill the pattern!\n    context.fillStyle = this._canvasPattern;\n\n    const anchorX = this.uvRespectAnchor ? this.anchor.x * -W : 0;\n    const anchorY = this.uvRespectAnchor ? this.anchor.y * -H : 0;\n\n    tempPoints[0].set(anchorX, anchorY);\n    tempPoints[1].set(anchorX + W, anchorY);\n    tempPoints[2].set(anchorX + W, anchorY + H);\n    tempPoints[3].set(anchorX, anchorY + H);\n    for (let i = 0; i < 4; i++)\n    {\n        lt.applyInverse(tempPoints[i], tempPoints[i]);\n    }\n\n    context.beginPath();\n    context.moveTo(tempPoints[0].x, tempPoints[0].y);\n    for (let i = 1; i < 4; i++)\n    {\n        context.lineTo(tempPoints[i].x, tempPoints[i].y);\n    }\n    context.closePath();\n    context.fill();\n};\n"],"names":["Matrix","Point","TilingSprite","CanvasRenderTarget","canvasUtils"],"mappings":";;;;;;;;;;;;;;AAOA,IAAM,UAAU,GAAG,IAAIA,WAAM,EAAE,CAAC;AAChC,IAAM,UAAU,GAAG,CAAC,IAAIC,UAAK,EAAE,EAAE,IAAIA,UAAK,EAAE,EAAE,IAAIA,UAAK,EAAE,EAAE,IAAIA,UAAK,EAAE,CAAC,CAAC;;;;;;;;;AAUxEC,yBAAY,CAAC,SAAS,CAAC,aAAa,GAAG,SAAS,aAAa,CAAC,QAAwB;IAElF,IAAM,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC;IAE9B,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,KAAK,EAC9B;QACI,OAAO;KACV;IAED,IAAM,OAAO,GAAG,QAAQ,CAAC,OAAO,CAAC;IACjC,IAAM,SAAS,GAAG,IAAI,CAAC,cAAc,CAAC;IACtC,IAAM,WAAW,GAAG,OAAO,CAAC,WAAW,CAAC;IACxC,IAAM,MAAM,GAAG,WAAW,CAAC,iBAAiB,EAAE,CAAC;IAC/C,IAAM,qBAAqB,GAAG,WAAW,CAAC,UAAU,CAAC;;IAGrD,IAAI,IAAI,CAAC,UAAU,KAAK,IAAI,CAAC,QAAQ,CAAC,SAAS,IAAI,IAAI,CAAC,WAAW,KAAK,IAAI,CAAC,IAAI,EACjF;QACI,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;;QAE1C,IAAM,UAAU,GAAG,IAAIC,wBAAkB,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,EAC1D,OAAO,CAAC,MAAM,CAAC,MAAM,EACrB,qBAAqB,CAAC,CAAC;;QAG3B,IAAI,IAAI,CAAC,IAAI,KAAK,QAAQ,EAC1B;YACI,IAAI,CAAC,aAAa,GAAGC,0BAAW,CAAC,eAAe,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAsB,CAAC;YACvF,UAAU,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;SAC1D;aAED;YACI,UAAU,CAAC,OAAO,CAAC,SAAS,CAAC,MAAM,EAC/B,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,GAAG,qBAAqB,EAAE,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,GAAG,qBAAqB,CAAC,CAAC;SAC7F;QACD,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC;QAC7B,IAAI,CAAC,cAAc,GAAG,UAAU,CAAC,OAAO,CAAC,aAAa,CAAC,UAAU,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;KACvF;;IAGD,OAAO,CAAC,WAAW,GAAG,IAAI,CAAC,UAAU,CAAC;IACtC,QAAQ,CAAC,YAAY,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;IAEtC,IAAI,CAAC,aAAa,CAAC,oBAAoB,EAAE,CAAC;IAC1C,IAAM,EAAE,GAAG,IAAI,CAAC,aAAa,CAAC,cAAc,CAAC;IAC7C,IAAM,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC;IACtB,IAAM,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC;IAEvB,UAAU,CAAC,QAAQ,EAAE,CAAC;IACtB,UAAU,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;IACxB,UAAU,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;IAE9B,QAAQ,CAAC,mBAAmB,CAAC,UAAU,CAAC,CAAC;;IAGzC,OAAO,CAAC,SAAS,GAAG,IAAI,CAAC,cAAc,CAAC;IAExC,IAAM,OAAO,GAAG,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;IAC9D,IAAM,OAAO,GAAG,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;IAE9D,UAAU,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;IACpC,UAAU,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,OAAO,GAAG,CAAC,EAAE,OAAO,CAAC,CAAC;IACxC,UAAU,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,OAAO,GAAG,CAAC,EAAE,OAAO,GAAG,CAAC,CAAC,CAAC;IAC5C,UAAU,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,OAAO,EAAE,OAAO,GAAG,CAAC,CAAC,CAAC;IACxC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAC1B;QACI,EAAE,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC,CAAC,EAAE,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;KACjD;IAED,OAAO,CAAC,SAAS,EAAE,CAAC;IACpB,OAAO,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACjD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAC1B;QACI,OAAO,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;KACpD;IACD,OAAO,CAAC,SAAS,EAAE,CAAC;IACpB,OAAO,CAAC,IAAI,EAAE,CAAC;CAClB,CAAC"}